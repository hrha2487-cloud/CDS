---
title: "Assignment 4: Capital Bikeshare"
author: "Ruihan He"
date: "`9-16-2025`"
documentclass: article
geometry: margin=1in
fontsize: 11pt
output:
  pdf_document:
    toc: false
    df_print: kable
    fig_caption: false
    number_sections: false
    dev: pdf
    highlight: tango
  html_document:
    theme: default
    self_contained: true
    toc: false
    df_print: kable
    fig_caption: false
    number_sections: false
    smart: true
    dev: svg
---

```{r setup, include = FALSE, echo=FALSE}
# DO NOT ALTER THIS CHUNK
knitr::opts_chunk$set(
  echo = TRUE,
  eval = TRUE,
  fig.width = 5,
  fig.asp = 0.618,
  dpi = 120,
  fig.align = "center",
  cache = FALSE
)
# Load required packages
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(lubridate))
suppressPackageStartupMessages(library(geosphere))
bikeshare <- readRDS("bikeshare_data.RDS")
```


## Exercise 1
start_lat  end_lat
rideable_type member_causal
Each row = one bike trip.

## Exercise 2
```{r}
bikeshare <- bikeshare %>%
  mutate(
    duration = ended_at - started_at
  )
```


## Exercise 3
```{r}
bikeshare %>%
  ggplot() +
  geom_histogram(mapping = aes(x = duration)) +
  labs(title = "Distribution of Capital Bikeshare Trip Durations", x = "Duration (seconds)")
```
The histogram shows that most Capital Bikeshare trips are short, but there is a long tail of longer trips, resulting in a right-skewed distribution.


## Exercise 4
```{r}
library(ggplot2)
library(dplyr)

bikeshare %>%
  ggplot() +
  geom_boxplot(aes(y = duration)) +
  labs(
    title = "Box Plot of Capital Bikeshare Trip Durations",
    y = "Duration (seconds)"
  )
```
Box plot code was adapted from https://r-graph-gallery.com/boxplot.html. 
I modified it to use the bikeshare dataframe and the duration variable.

Center: The middle line of the box shows the median duration.
Skewness: The box plot is right-skewed, just like the histogram, because there are some very long trips.
Comparison to histogram:
Both show right skew.
Box plot highlights the median, quartiles, and extreme values more clearly.


## Exercise 5
```{r}
bikeshare %>%
  ggplot() +
  geom_violin(aes(x = duration, y = "")) +
  labs(
    title = "Violin Plot of Capital Bikeshare Trip Durations",
    x = "Duration (seconds)"
  )
```
Center: The middle, widest part of the violin corresponds roughly to the median trip duration, indicating that most trips are relatively short.
Shape: The distribution is clearly right-skewed, with a few very long trips creating a long tail on the right side.
Comparison with previous plots:
The histogram and box plot also show the right-skewed distribution.
Compared to the histogram, the violin plot more clearly shows the density of short trips and the sparsity of long trips.
Compared to the box plot, the violin plot shows not only the median and quartiles but also the continuous density of the data.


## Exercise 6
```{r}
bikeshare <- bikeshare %>%
  mutate(
    min_distance = distHaversine(
      cbind(start_lng, start_lat), 
      cbind(end_lng, end_lat)
      )
  )
head(bikeshare)
```



## Exercise 7
```{r hist-min-distance}
bikeshare %>%
  ggplot(aes(x = min_distance)) +
  geom_histogram() +
  labs(
    title = "Histogram of Minimum Ride Distances",
    x = "Minimum Distance (meters)"
  )
```

```{r boxplot-min-distance}
bikeshare %>%
  ggplot(aes(y = min_distance)) +
  geom_boxplot() +
  labs(
    title = "Box Plot of Minimum Ride Distances",
    y = "Minimum Distance (meters)"
  )
```

```{r violin-min-distance}
bikeshare %>%
  ggplot(aes(x = min_distance, y = "")) +
  geom_violin() +
  labs(
    title = "Violin Plot of Minimum Ride Distances",
    x = "Minimum Distance (meters)"
  )
```
The distribution of the minimum ride distances is highly right-skewed. Most rides have very short minimum distances, and there are a small number of rides with much larger minimum distances, producing a long tail to the right.

The center of the distribution is at a relatively low distance.



## Exercise 8
```{r}
bikeshare %>%
  ggplot() +
  geom_point(aes(x = duration, y = min_distance)) +
  labs(
    title = "Scatter plot of minimum distance vs. duration",
    x = "Duration (seconds)",
    y = "Minimum distance (meters)"
  )
```

```{r}
bikeshare %>%
  ggplot(aes(x = duration, y = min_distance)) +
  geom_point(alpha = 0.01) +
  labs(
    title = "Scatter plot of minimum distance vs. duration (transparent points)",
    x = "Duration (seconds)",
    y = "Minimum distance (meters)"
  )
```

```{r}
bikeshare %>%
  ggplot() +
  geom_bin2d(aes(x = duration, y = min_distance)) +
  labs(
    title = "2-D histogram of minimum distance vs. duration",
    x = "Duration (seconds)",
    y = "Minimum distance (meters)"
  )
```

```{r}
bikeshare %>%
  ggplot() +
  geom_bin2d(aes(x = duration, y = min_distance)) +
  labs(
    title = "2-D histogram of minimum distance vs. duration (log color scale)",
    x = "Duration (seconds)",
    y = "Minimum distance (meters)"
  ) +
  scale_fill_viridis_c(trans = "log")
```


## Exercise 9
```{r}
bikeshare %>%
  summarize(
    mean = mean(duration),
    median = median(duration),
    standard_deviation = sd(duration),
    minimum = min(duration),
    maximum = max(duration)
  )
```
The histogram and boxplot from Exercise 3 showed a right-skewed distribution with a few very long rides. These extreme values pull the mean upward more than the median, so the mean ride length ends up larger than the median.
```{r}
bikeshare %>%
  group_by(member_casual) %>%
  summarize(
    mean = mean(duration),
    median = median(duration),
    standard_deviation = sd(duration),
    minimum = min(duration),
    maximum = max(duration)
  )
```
Casual users have the longest average ride length.
Yes.
```{r}
bikeshare %>%
  group_by(member_casual) %>%
  summarize(
    n = n()
  )
```
Members take the most rides overall.

## Exercise 10
```{r}
bikeshare %>%
  ggplot(aes(x = duration, fill = member_casual)) +
  geom_histogram(bins = 20, alpha = 0.3, position = "identity") +
  labs(
    title = "Histogram of Ride Duration by Rider Type",
    x = "Duration (seconds)",
    y = "Count",
    fill = "Rider Type"
  )
```
Ride duration clearly covaries with rider type. Members take the majority of short rides, clustering at lower durations, while casual users are more common among longer rides.
```{r}
bikeshare %>%
  ggplot(aes(x = duration, y = member_casual)) +
  geom_violin() +
  labs(
    title = "Violin Plot of Ride Duration by Rider Type",
    x = "Duration (seconds)",
    y = "Rider Type"
  )
```

```{r}
bikeshare %>%
  ggplot() +
  geom_bin2d(aes(x = duration, y = min_distance)) +
  labs(
    title = "2-D Histogram of Minimum Distance vs Duration by Rider Type",
    x = "Duration (seconds)",
    y = "Minimum Distance (meters)"
  ) +
  scale_fill_viridis_c(trans = "log") +
  facet_wrap(~ member_casual)
```
The faceted heatmap shows that casual riders have more rides with long durations but low minimum distances compared to members. This suggests that casual users often take slow or round-trip leisure rides, whereas membersâ€™ rides are generally shorter in both duration and distance.

## Exercise 11
```{r}
bikeshare <- bikeshare %>%
  mutate(
    day_of_week = wday(started_at) 
  )
```

```{r}
bikeshare %>%
  ggplot(aes(x = duration, y = min_distance, color = member_casual)) +
  geom_point(alpha = 0.01) +
  labs(
    title = "Ride Duration vs Minimum Distance by Rider Type",
    x = "Duration (seconds)",
    y = "Minimum Distance (meters)",
    color = "Rider Type"
  )
```




## Academic Integrity statement




